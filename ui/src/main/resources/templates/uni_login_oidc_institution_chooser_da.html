<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="da">

<head>
    <title>Vælg institution - UNI•Login</title>
    {{> metadata}}
    <style>
        .institution-chooser {
            max-width: 600px;
            margin: 60px auto;
            padding: 40px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .institution-chooser h1 {
            margin-top: 0;
            margin-bottom: 24px;
            color: #08486D;
            font-size: 28px;
            text-align: center;
        }

        .institution-chooser .description {
            text-align: center;
            color: #666;
            margin-bottom: 32px;
            font-size: 16px;
        }

        .institution-chooser form {
            margin: 0;
        }

        .institution-chooser .form-group {
            margin-bottom: 24px;
        }

        .institution-chooser label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .institution-chooser select {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border: 2px solid #d2d2d2;
            border-radius: 4px;
            background-color: #ffffff;
            color: #000;
            cursor: pointer;
            transition: border-color 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        .institution-chooser select:hover {
            border-color: #23C19D;
        }

        .institution-chooser select:focus {
            border-color: #23C19D;
            outline: none;
            box-shadow: 0 0 0 3px rgba(35, 193, 157, 0.1);
        }

        .institution-chooser select option {
            padding: 12px;
            background-color: #ffffff;
        }

        .institution-chooser select option:checked {
            background-color: #23C19D;
            color: #ffffff;
        }

        .institution-chooser .institution-option {
            display: block;
            padding: 8px 0;
        }

        .institution-chooser .institution-id {
            font-weight: 600;
            color: #08486D;
        }

        .institution-chooser .institution-name {
            color: #333;
            margin-left: 8px;
        }

        .institution-chooser .institution-roles {
            display: block;
            font-size: 13px;
            color: #666;
            margin-top: 4px;
            font-style: italic;
        }

        .institution-chooser .submit-button {
            width: 100%;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            background-color: #23C19D;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            margin-top: 8px;
        }

        .institution-chooser .submit-button:hover:not(:disabled) {
            background-color: #08486D;
            transform: translateY(-1px);
        }

        .institution-chooser .submit-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .institution-chooser .submit-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .institution-chooser .loading-message {
            text-align: center;
            color: #23C19D;
            margin-top: 16px;
            font-size: 14px;
            display: none;
        }

        .institution-chooser .loading-message.show {
            display: block;
        }

        @media (max-width: 576px) {
            .institution-chooser {
                margin: 20px;
                padding: 24px;
            }

            .institution-chooser h1 {
                font-size: 24px;
            }
        }
    </style>
</head>

<body>
<div class="institution-chooser">
    <h1>Vælg din institution</h1>
    <p class="description">Vælg den institution, du vil logge ind med:</p>

    <form action="/unilogin/org" method="post">
        <div class="form-group">
            <label for="institution">Institution</label>
            <select id="institution" name="institution" required>
                <option value="">-- Vælg institution --</option>
                {{#institutionList}}
                <option value="{{id}}">
                    {{id}} : {{name}}{{#roles}} ({{#roles}}{{.}}, {{/roles}}){{/roles}}
                </option>
                {{/institutionList}}
            </select>
        </div>
        <input type="hidden" name="user" value="{{user}}">
        <!-- Button hidden but still functional for programmatic submission -->
        <button type="submit" class="submit-button" id="submitBtn" style="position: absolute; left: -9999px; width: 1px; height: 1px; opacity: 0;">
            Fortsæt med login
        </button>
        <div class="loading-message" id="loadingMsg">
            Logger ind...
        </div>
    </form>
</div>

<script>
    // Auto-submit form when institution is selected
    const select = document.getElementById('institution');
    const form = document.querySelector('form');
    const submitBtn = document.getElementById('submitBtn');
    const loadingMsg = document.getElementById('loadingMsg');
    let isSubmitting = false;
    
    select.addEventListener('change', function() {
        // Skip if it's the default empty option or already submitting
        if (!select.value || select.value.trim() === '' || isSubmitting) {
            return;
        }
        
        isSubmitting = true;
        
        // Show loading message
        loadingMsg.classList.add('show');
        
        // Disable select to prevent multiple submissions
        select.disabled = true;
        
        // Small delay to ensure browser has processed the change event
        setTimeout(function() {
            // Double-check the value is still there
            if (!select.value || select.value.trim() === '') {
                // Value is missing, re-enable
                select.disabled = false;
                loadingMsg.classList.remove('show');
                isSubmitting = false;
                return;
            }
            
            // Click the submit button instead of calling form.submit()
            // This ensures the browser properly serializes all form fields
            submitBtn.click();
        }, 50);
    });
</script>
</body>
</html>
